<!DOCTYPE html>
<html>
<head>
	<script src="js/openings.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
	<script src="js/chessboard-0.3.0.min.js"></script>
	<link rel="stylesheet" type="text/css" href="css/chessboard-0.3.0.min.css">
	<title>Chess openings</title>
	<style type="text/css">
		body{
		}
		#board {
			width: 300px;
			position: fixed;
			right: 10px;
			top: 50px;
			cursor: pointer;
		}
		#board:hover {
			box-shadow: 0px 0px 10px 1px gray;
		}
		.highlight {
			font-weight: bold;
			background-color: lightgray;
		}
		#list * {
			cursor: pointer;
			font-family: monospace;
			display: block;
			float: left;
			clear: left;
			text-decoration: none;
			color: black;
			padding-left: 4px;
			padding-right: 4px;
		}
		#list div:hover {
			background-color: #dedede;
		}
	</style>
</head>
<body>
<div id="board"></div>
<div id="list">
	
</div>
</body>
<script type="text/javascript">
var list = document.getElementById("list");
var board = ChessBoard("board", {
	"position": "start",
	"showNotation": false
});

for(fen in window.CHESS_OPENINGS) {
	var op = document.createElement("div");
	var openingName = window.CHESS_OPENINGS[fen].eco + " " + window.CHESS_OPENINGS[fen].name;
	op.id = openingName.replace(/\s/g, "_");
	op.textContent = openingName;
	op.setAttribute("fen", fen);
	op.setAttribute("turn", fen.indexOf(" w ") === -1 ? "b" : "w");

	op.addEventListener("click", function(e) {
		var old = $(".highlight")[0];
		if(old) {
			old.className = "";
		}
		this.className = "highlight";
		var fen = this.getAttribute("fen") + " - 0 1";
		board.position(fen);
		history.pushState(null, null, "#" + this.id);
	});

	list.appendChild(op);
}

document.addEventListener("keypress", function(e) {
	if(e.key === "f") {
		board.flip();
	}
});

document.getElementById("board").addEventListener("click", function(e) {
	var turn = "w";
	var h = $(".highlight")[0];
	if(h) {
		turn = h.getAttribute("turn");
	}
	window.open("https://lichess.org/analysis/" + board.fen() + "_" + turn, "_blank");
});

document.addEventListener("DOMContentLoaded", function(e) {
	if(window.location.hash) {
		var op = document.getElementById(window.location.hash.substring(1));
		op.click();
	}
});
</script>
</html>